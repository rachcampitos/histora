<ion-header class="ion-no-border" [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <div class="header-brand">
        <img src="assets/icon/nurselite.png" alt="NurseLite" class="header-logo">
      </div>
    </ion-buttons>
    <ion-title>NurseLite</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openNotifications()" class="notification-btn">
        <ion-icon slot="icon-only" name="notifications-outline"></ion-icon>
        @if (unreadNotifications() > 0) {
          <div class="notification-badge">{{ unreadNotifications() > 9 ? '9+' : unreadNotifications() }}</div>
        }
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">NurseLite</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Active Service Banner - Prominent when service is active -->
  @if (activeRequest()) {
    <div class="active-service-banner"
         [class.pending]="activeRequest()!.status === 'pending'"
         (click)="viewActiveRequest()">
      @if (activeRequest()!.status !== 'pending') {
        <div class="banner-pulse"></div>
      }
      <div class="banner-content">
        <div class="banner-icon">
          <ion-icon [name]="activeRequest()!.status === 'pending' ? 'time' :
                           activeRequest()!.status === 'accepted' ? 'checkmark-circle' :
                           activeRequest()!.status === 'on_the_way' ? 'navigate' :
                           activeRequest()!.status === 'arrived' ? 'location' : 'medical'"></ion-icon>
        </div>
        <div class="banner-info">
          @if (activeRequest()!.status === 'pending') {
            <h3>Solicitud Pendiente</h3>
            <p>Esperando confirmacion - {{ activeRequest()!.service.name }}</p>
          } @else {
            <h3>Servicio en Curso</h3>
            <p>
              {{ activeRequest()!.nurse?.firstName || 'Enfermera' }} -
              {{ activeRequest()!.service.name }}
            </p>
          }
        </div>
        <ion-icon name="chevron-forward" class="banner-arrow"></ion-icon>
      </div>
      <ion-badge [color]="getStatusColor(activeRequest()!.status)">
        {{ getStatusLabel(activeRequest()!.status) }}
      </ion-badge>
    </div>
  }

  <!-- Hero Section - Compact -->
  <section class="hero-section" role="banner" id="tour-main-action">
    <div class="hero-content">
      <!-- Inline Greeting -->
      <div class="greeting-inline">
        @if (user()?.avatar) {
          <img [src]="user()!.avatar" class="hero-avatar"
               [alt]="'Foto de perfil de ' + (user()?.firstName || 'usuario')" loading="eager" />
        } @else {
          <div class="hero-avatar hero-avatar-placeholder">
            <ion-icon name="person" aria-hidden="true"></ion-icon>
          </div>
        }
        <span class="greeting-text">Hola {{ user()?.firstName || 'Usuario' }}, ¿como te ayudamos hoy?</span>
      </div>

      <!-- Main CTA -->
      <button
        class="hero-cta"
        (click)="goToMap()"
        aria-label="Buscar enfermera disponible cerca de ti">
        <div class="cta-content">
          <ion-icon name="search-outline" class="cta-icon"></ion-icon>
          <span class="cta-text">Necesito una enfermera</span>
        </div>
        <ion-icon name="chevron-forward" class="cta-arrow"></ion-icon>
      </button>

      <!-- Trust Badges - Enhanced with warm colors -->
      <div class="trust-badges-enhanced">
        <div class="trust-badge">
          <ion-icon name="shield-checkmark"></ion-icon>
          <div class="badge-content">
            <span class="badge-title">100% Verificadas</span>
            <span class="badge-subtitle">Colegio de Enfermeros</span>
          </div>
        </div>
        <div class="trust-badge">
          <ion-icon name="time"></ion-icon>
          <div class="badge-content">
            <span class="badge-title">Atencion 24/7</span>
            <span class="badge-subtitle">Todos los dias</span>
          </div>
        </div>
        <div class="trust-badge">
          <ion-icon name="people"></ion-icon>
          <div class="badge-content">
            <span class="badge-title">+500 servicios</span>
            <span class="badge-subtitle">Este mes en Lima</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Quick Access Hub -->
  <nav id="tour-quick-actions" class="quick-access-hub" aria-label="Acciones rápidas">
    <button
      class="quick-btn"
      (click)="goToHistory()"
      aria-label="Ver historial de servicios">
      <ion-icon name="time-outline" class="quick-icon"></ion-icon>
      <span class="quick-label">Historial</span>
    </button>

    <button
      class="quick-btn"
      (click)="goToMyNurses()"
      aria-label="Ver mi equipo de confianza">
      <ion-icon name="heart-outline" class="quick-icon"></ion-icon>
      <span class="quick-label">De Confianza</span>
    </button>

    <button
      class="quick-btn"
      (click)="goToSettings()"
      aria-label="Ir a configuración">
      <ion-icon name="settings-outline" class="quick-icon"></ion-icon>
      <span class="quick-label">Ajustes</span>
    </button>
  </nav>

  <!-- Recent Nurses Section -->
  @if (recentNurses().length > 0) {
    <section class="recent-nurses-section" aria-labelledby="recent-nurses-title">
      <h3 id="recent-nurses-title" class="section-title-compact">
        <ion-icon name="time-outline" aria-hidden="true"></ion-icon>
        Recientes
      </h3>
      <div class="recent-nurses-list" role="list">
        @for (nurse of recentNurses(); track nurse.nurseId) {
          <button
            class="recent-nurse-item"
            role="listitem"
            (click)="selectRecentNurse(nurse)"
            [attr.aria-label]="'Solicitar servicio de ' + (nurse.firstName || 'enfermera') + ' ' + (nurse.lastName || '')">
            @if (nurse.avatar) {
              <img [src]="nurse.avatar" class="nurse-avatar-recent"
                   [alt]="(nurse.firstName || 'Enfermera') + ' ' + (nurse.lastName || '')" loading="lazy" />
            } @else {
              <div class="nurse-avatar-recent nurse-avatar-placeholder">
                <ion-icon name="person" aria-hidden="true"></ion-icon>
              </div>
            }
            <span class="nurse-name-recent">{{ nurse.firstName || 'Enfermera' }}</span>
          </button>
        }
      </div>
    </section>
  }

  <!-- Bottom padding for tab bar -->
  <div class="bottom-spacer"></div>
</ion-content>
