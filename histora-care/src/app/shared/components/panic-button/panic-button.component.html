<!-- Active Alert Banner -->
@if (activeAlert()) {
  <div class="active-alert-banner" [class.emergency]="activeAlert()!.level === 'emergency'">
    <div class="alert-content">
      <div class="alert-icon">
        <ion-icon name="warning"></ion-icon>
        <div class="pulse-ring"></div>
      </div>
      <div class="alert-info">
        <span class="alert-level">
          {{ activeAlert()!.level === 'emergency' ? 'EMERGENCIA ACTIVA' : 'ALERTA ACTIVA' }}
        </span>
        <span class="alert-status">{{ getAlertStatusText() }}</span>
      </div>
    </div>
    <ion-button fill="clear" size="small" color="light" (click)="cancelAlert()" aria-label="Cancelar alerta">
      <ion-icon slot="icon-only" name="close-circle"></ion-icon>
    </ion-button>
  </div>
}

<!-- Panic Button -->
@if (!activeAlert()) {
  <div class="panic-button-container" [class.compact]="compact">
    <button
      class="panic-button"
      [class.active]="isActive()"
      [class.loading]="isLoading()"
      [class.tap-1]="tapCount() === 1"
      [class.tap-2]="tapCount() === 2"
      [class.tap-3]="tapCount() === 3"
      (click)="onTap()"
      [disabled]="isLoading()">

      <!-- Tap counter indicator -->
      <div class="tap-indicators">
        @for (i of [1, 2, 3]; track i) {
          <div class="tap-dot" [class.filled]="tapCount() >= i"></div>
        }
      </div>

      <!-- Button content -->
      <div class="button-content">
        @if (isLoading()) {
          <ion-spinner name="crescent" color="light"></ion-spinner>
        } @else {
          <ion-icon name="shield"></ion-icon>
          @if (!compact) {
            <span class="button-text">SOS</span>
          }
        }
      </div>

      <!-- Tap count display -->
      @if (tapCount() > 0 && tapCount() < 3) {
        <div class="tap-count">{{ tapCount() }}/3</div>
      }
    </button>

    @if (!compact) {
      <p class="help-text">
        @if (tapCount() === 0) {
          Toca 3 veces rapido para activar
        } @else {
          {{ 3 - tapCount() }} toque{{ (3 - tapCount()) !== 1 ? 's' : '' }} mas
        }
      </p>
    }
  </div>
}
