<!-- Active Alert Banner -->
@if (activeAlert()) {
  <div class="active-alert-banner" [class.emergency]="activeAlert()!.level === 'emergency'">
    <div class="alert-content">
      <div class="alert-icon">
        <ion-icon name="warning"></ion-icon>
        <div class="pulse-ring"></div>
      </div>
      <div class="alert-info">
        <span class="alert-level">
          {{ activeAlert()!.level === 'emergency' ? 'EMERGENCIA ACTIVA' : 'ALERTA ACTIVA' }}
        </span>
        <span class="alert-status">{{ getAlertStatusText() }}</span>
      </div>
    </div>
    <ion-button fill="clear" size="small" color="light" (click)="cancelAlert()">
      <ion-icon slot="icon-only" name="close-circle"></ion-icon>
    </ion-button>
  </div>
}

<!-- Panic Button -->
@if (!activeAlert()) {
  <div class="panic-button-container" [class.compact]="compact">
    <button
      class="panic-button"
      [class.holding]="isHolding()"
      [class.loading]="isLoading()"
      (touchstart)="onPressStart()"
      (touchend)="onPressEnd()"
      (touchcancel)="onPressEnd()"
      (mousedown)="onPressStart()"
      (mouseup)="onPressEnd()"
      (mouseleave)="onPressEnd()"
      [disabled]="isLoading()">

      <!-- Progress ring -->
      <svg class="progress-ring" viewBox="0 0 100 100">
        <circle
          class="progress-ring-background"
          cx="50"
          cy="50"
          r="45"
          fill="none"
          stroke-width="8"
        />
        <circle
          class="progress-ring-fill"
          cx="50"
          cy="50"
          r="45"
          fill="none"
          stroke-width="8"
          [style.stroke-dashoffset]="283 - (283 * holdProgress() / 100)"
        />
      </svg>

      <!-- Button content -->
      <div class="button-content">
        @if (isLoading()) {
          <ion-spinner name="crescent" color="light"></ion-spinner>
        } @else {
          <ion-icon name="shield"></ion-icon>
          @if (!compact) {
            <span class="button-text">SOS</span>
          }
        }
      </div>
    </button>

    @if (!compact) {
      <p class="help-text">Mant√©n presionado 3 segundos para activar</p>
    }
  </div>
}
