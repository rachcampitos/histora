<ion-header>
  <ion-toolbar>
    <ion-title>Califica el servicio</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cancel()" [disabled]="isSubmitting()">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="review-container">
    <!-- Nurse Info (optional) -->
    @if (nurseName) {
      <div class="nurse-info">
        <p class="nurse-label">Tu experiencia con</p>
        <h2 class="nurse-name">{{ nurseName }}</h2>
      </div>
    }

    <!-- Star Rating -->
    <div class="rating-section">
      <p class="rating-instruction">Selecciona tu calificacion</p>
      <div class="stars-container">
        @for (star of stars; track star) {
          <button
            class="star-button"
            [class.filled]="isStarFilled(star)"
            (click)="onStarClick(star)"
            (mouseenter)="onStarHover(star)"
            (mouseleave)="onStarLeave()"
            [attr.aria-label]="star + ' estrella' + (star > 1 ? 's' : '')"
            type="button">
            <ion-icon [name]="getStarIcon(star)"></ion-icon>
          </button>
        }
      </div>
      @if (rating() > 0) {
        <p class="rating-label">{{ getRatingLabel() }}</p>
      }
    </div>

    <!-- Comment Section -->
    <div class="comment-section">
      <ion-label class="comment-label">Cuentanos tu experiencia</ion-label>
      <ion-textarea
        class="comment-textarea"
        [value]="comment()"
        (ionInput)="updateComment($event)"
        placeholder="Escribe tu comentario aqui (opcional)..."
        [rows]="4"
        [maxlength]="500"
        [counter]="true"
        [disabled]="isSubmitting()">
      </ion-textarea>
    </div>
  </div>
</ion-content>

<ion-footer class="ion-padding">
  <div class="footer-buttons">
    <ion-button
      fill="outline"
      expand="block"
      (click)="cancel()"
      [disabled]="isSubmitting()">
      Cancelar
    </ion-button>
    <ion-button
      expand="block"
      (click)="submit()"
      [disabled]="!canSubmit()">
      @if (isSubmitting()) {
        <ion-spinner name="crescent"></ion-spinner>
      } @else {
        Enviar
      }
    </ion-button>
  </div>
</ion-footer>
