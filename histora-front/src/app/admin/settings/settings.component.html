<section class="content">
  <div class="content-block">
    <div class="block-header">
      <app-breadcrumb [title]="'Configuración'" [items]="['Admin']" [active_item]="'Configuración'"></app-breadcrumb>
    </div>

    <mat-tab-group>
      <!-- Profile Tab -->
      <mat-tab label="Perfil">
        <div class="tab-content">
          <div class="card">
            <div class="header">
              <h2>Información Personal</h2>
            </div>
            <div class="body">
              <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
                <div class="row">
                  <div class="col-md-6">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Nombre</mat-label>
                      <input matInput formControlName="firstName">
                      @if (profileForm.get('firstName')?.hasError('required')) {
                        <mat-error>El nombre es requerido</mat-error>
                      }
                    </mat-form-field>
                  </div>
                  <div class="col-md-6">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Apellidos</mat-label>
                      <input matInput formControlName="lastName">
                      @if (profileForm.get('lastName')?.hasError('required')) {
                        <mat-error>Los apellidos son requeridos</mat-error>
                      }
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Email</mat-label>
                      <input matInput formControlName="email" type="email">
                      @if (profileForm.get('email')?.hasError('required')) {
                        <mat-error>El email es requerido</mat-error>
                      }
                      @if (profileForm.get('email')?.hasError('email')) {
                        <mat-error>Email inválido</mat-error>
                      }
                    </mat-form-field>
                  </div>
                  <div class="col-md-6">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Teléfono</mat-label>
                      <input matInput formControlName="phone">
                    </mat-form-field>
                  </div>
                </div>

                <div class="form-actions">
                  <button mat-flat-button color="primary" type="submit" [disabled]="profileForm.invalid">
                    <mat-icon>save</mat-icon>
                    Guardar Cambios
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Password Change -->
          <div class="card">
            <div class="header">
              <h2>Cambiar Contraseña</h2>
            </div>
            <div class="body">
              <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Contraseña Actual</mat-label>
                      <input matInput formControlName="currentPassword" [type]="hideCurrentPassword ? 'password' : 'text'">
                      <button mat-icon-button matSuffix type="button" (click)="hideCurrentPassword = !hideCurrentPassword">
                        <mat-icon>{{ hideCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                      </button>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Nueva Contraseña</mat-label>
                      <input matInput formControlName="newPassword" [type]="hideNewPassword ? 'password' : 'text'">
                      <button mat-icon-button matSuffix type="button" (click)="hideNewPassword = !hideNewPassword">
                        <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                      </button>
                      @if (passwordForm.get('newPassword')?.hasError('minlength')) {
                        <mat-error>Mínimo 8 caracteres</mat-error>
                      }
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Confirmar Contraseña</mat-label>
                      <input matInput formControlName="confirmPassword" [type]="hideConfirmPassword ? 'password' : 'text'">
                      <button mat-icon-button matSuffix type="button" (click)="hideConfirmPassword = !hideConfirmPassword">
                        <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                      </button>
                    </mat-form-field>
                  </div>
                </div>

                <div class="form-actions">
                  <button mat-flat-button color="warn" type="submit" [disabled]="passwordForm.invalid">
                    <mat-icon>lock</mat-icon>
                    Cambiar Contraseña
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </mat-tab>

      <!-- Platform Settings Tab -->
      <mat-tab label="Plataforma">
        <div class="tab-content">
          <div class="card">
            <div class="header">
              <h2>Configuración General</h2>
            </div>
            <div class="body">
              <form [formGroup]="platformForm" (ngSubmit)="savePlatformSettings()">
                <div class="row">
                  <div class="col-md-6">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Nombre de la Plataforma</mat-label>
                      <input matInput formControlName="platformName">
                    </mat-form-field>
                  </div>
                  <div class="col-md-6">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Email de Soporte</mat-label>
                      <input matInput formControlName="supportEmail" type="email">
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Días de Prueba</mat-label>
                      <input matInput formControlName="trialDays" type="number">
                    </mat-form-field>
                  </div>
                  <div class="col-md-6">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Idioma por Defecto</mat-label>
                      <mat-select formControlName="defaultLanguage">
                        <mat-option value="es">Español</mat-option>
                        <mat-option value="en">English</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>

                <div class="toggle-option">
                  <mat-slide-toggle formControlName="maintenanceMode" color="warn">
                    Modo Mantenimiento
                  </mat-slide-toggle>
                  <span class="toggle-hint">Activar para mostrar página de mantenimiento a usuarios</span>
                </div>

                <div class="form-actions">
                  <button mat-flat-button color="primary" type="submit" [disabled]="platformForm.invalid">
                    <mat-icon>save</mat-icon>
                    Guardar Configuración
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </mat-tab>

      <!-- Notifications Tab -->
      <mat-tab label="Notificaciones">
        <div class="tab-content">
          <div class="card">
            <div class="header">
              <h2>Preferencias de Notificación</h2>
            </div>
            <div class="body">
              <form [formGroup]="notificationsForm" (ngSubmit)="saveNotifications()">
                <h4 class="section-title">Notificaciones por Email</h4>

                <div class="toggle-option">
                  <mat-slide-toggle formControlName="emailNewClinic" color="primary">
                    Nueva clínica registrada
                  </mat-slide-toggle>
                </div>

                <div class="toggle-option">
                  <mat-slide-toggle formControlName="emailNewSubscription" color="primary">
                    Nueva suscripción
                  </mat-slide-toggle>
                </div>

                <div class="toggle-option">
                  <mat-slide-toggle formControlName="emailCancellation" color="primary">
                    Cancelación de suscripción
                  </mat-slide-toggle>
                </div>

                <div class="toggle-option">
                  <mat-slide-toggle formControlName="emailPaymentFailed" color="primary">
                    Pago fallido
                  </mat-slide-toggle>
                </div>

                <h4 class="section-title">Alertas del Sistema</h4>

                <div class="toggle-option">
                  <mat-slide-toggle formControlName="systemAlerts" color="primary">
                    Alertas críticas del sistema
                  </mat-slide-toggle>
                  <span class="toggle-hint">Errores de servidor, problemas de base de datos, etc.</span>
                </div>

                <div class="form-actions">
                  <button mat-flat-button color="primary" type="submit">
                    <mat-icon>save</mat-icon>
                    Guardar Preferencias
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</section>
