<div class="auth-container">
  <mat-card class="auth-card">
    <div class="card-content">
      <!-- Left side - Form -->
      <div class="form-section">
        <div class="form-content">
          <!-- Brand Logo -->
          <div class="brand-logo">
            <div class="logo-icon">
              <mat-icon>local_hospital</mat-icon>
            </div>
            <span class="logo-text">Histora</span>
          </div>

          <!-- Success State -->
          @if (success) {
          <div class="success-state">
            <div class="success-icon-wrapper">
              <div class="success-circle">
                <mat-icon>check</mat-icon>
              </div>
            </div>
            <h2 class="success-title">{{ 'AUTH.RESET.SUCCESS_TITLE' | translate }}</h2>
            <p class="success-subtitle">{{ 'AUTH.RESET.SUCCESS_SUBTITLE' | translate }}</p>
            <p class="redirect-text">{{ 'AUTH.RESET.REDIRECT' | translate }}</p>
            <button mat-raised-button class="create-btn" routerLink="/authentication/signin">
              {{ 'AUTH.RESET.GO_TO_LOGIN' | translate }}
            </button>
          </div>
          }

          <!-- Error State (Invalid/Expired Token) -->
          @if (error && !token) {
          <div class="error-state">
            <div class="error-icon-wrapper">
              <div class="error-circle">
                <mat-icon>link_off</mat-icon>
              </div>
            </div>
            <h2 class="error-title">{{ 'AUTH.RESET.INVALID_LINK' | translate }}</h2>
            <p class="error-subtitle">{{ 'AUTH.RESET.INVALID_LINK_DESC' | translate }}</p>
            <button mat-raised-button class="create-btn" routerLink="/authentication/forgot-password">
              {{ 'AUTH.RESET.REQUEST_NEW_LINK' | translate }}
            </button>
          </div>
          }

          <!-- Form State -->
          @if (!success && token) {
          <h2 class="title">{{ 'AUTH.RESET.TITLE' | translate }}</h2>
          <p class="subtitle">{{ 'AUTH.RESET.SUBTITLE' | translate }}</p>

          <!-- Error Message -->
          @if (error) {
          <div class="error-message">
            <mat-icon style="font-size: 18px; vertical-align: middle; margin-right: 8px;">error_outline</mat-icon>
            {{ error }}
          </div>
          }

          <form [formGroup]="authForm" (ngSubmit)="onSubmit()" class="auth-form">
            <!-- New Password Field -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'AUTH.RESET.NEW_PASSWORD' | translate }}</mat-label>
              <mat-icon matPrefix>lock</mat-icon>
              <input matInput formControlName="newPassword" [type]="hidePassword ? 'password' : 'text'"
                     autocomplete="new-password" (input)="checkPasswordStrength()" />
              <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword">
                <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              @if (authForm.get('newPassword')?.hasError('required') && submitted) {
              <mat-error>{{ 'AUTH.RESET.PASSWORD_REQUIRED' | translate }}</mat-error>
              }
              @if (authForm.get('newPassword')?.hasError('minlength')) {
              <mat-error>{{ 'AUTH.RESET.PASSWORD_MIN' | translate }}</mat-error>
              }
            </mat-form-field>

            <!-- Password Strength Indicator -->
            @if (authForm.get('newPassword')?.value) {
            <div class="password-strength">
              <div class="strength-bars">
                <div class="strength-bar" [class.active]="passwordStrength >= 1" [class.weak]="passwordStrength === 1" [class.medium]="passwordStrength === 2" [class.strong]="passwordStrength >= 3"></div>
                <div class="strength-bar" [class.active]="passwordStrength >= 2" [class.medium]="passwordStrength === 2" [class.strong]="passwordStrength >= 3"></div>
                <div class="strength-bar" [class.active]="passwordStrength >= 3" [class.strong]="passwordStrength >= 3"></div>
                <div class="strength-bar" [class.active]="passwordStrength >= 4" [class.very-strong]="passwordStrength >= 4"></div>
              </div>
              <span class="strength-text" [class.weak]="passwordStrength === 1" [class.medium]="passwordStrength === 2" [class.strong]="passwordStrength === 3" [class.very-strong]="passwordStrength >= 4">
                {{ passwordStrengthText }}
              </span>
            </div>
            }

            <!-- Password Requirements -->
            <div class="password-requirements">
              <div class="requirement" [class.met]="hasMinLength">
                <mat-icon>{{ hasMinLength ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>{{ 'AUTH.RESET.REQ_LENGTH' | translate }}</span>
              </div>
              <div class="requirement" [class.met]="hasUppercase">
                <mat-icon>{{ hasUppercase ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>{{ 'AUTH.RESET.REQ_UPPERCASE' | translate }}</span>
              </div>
              <div class="requirement" [class.met]="hasNumber">
                <mat-icon>{{ hasNumber ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>{{ 'AUTH.RESET.REQ_NUMBER' | translate }}</span>
              </div>
              <div class="requirement" [class.met]="hasSpecial">
                <mat-icon>{{ hasSpecial ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>{{ 'AUTH.RESET.REQ_SPECIAL' | translate }}</span>
              </div>
            </div>

            <!-- Confirm Password Field -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'AUTH.RESET.CONFIRM_PASSWORD' | translate }}</mat-label>
              <mat-icon matPrefix>lock_outline</mat-icon>
              <input matInput formControlName="confirmPassword" [type]="hideConfirmPassword ? 'password' : 'text'" autocomplete="new-password" />
              <button mat-icon-button matSuffix type="button" (click)="hideConfirmPassword = !hideConfirmPassword">
                <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              @if (authForm.get('confirmPassword')?.hasError('required') && submitted) {
              <mat-error>{{ 'AUTH.RESET.CONFIRM_REQUIRED' | translate }}</mat-error>
              }
              @if (authForm.get('confirmPassword')?.hasError('mismatch')) {
              <mat-error>{{ 'AUTH.RESET.PASSWORD_MISMATCH' | translate }}</mat-error>
              }
            </mat-form-field>

            <!-- Password Match Indicator -->
            @if (authForm.get('confirmPassword')?.value && authForm.get('newPassword')?.value) {
            <div class="password-match" [class.match]="!authForm.get('confirmPassword')?.hasError('mismatch')" [class.no-match]="authForm.get('confirmPassword')?.hasError('mismatch')">
              <mat-icon>{{ !authForm.get('confirmPassword')?.hasError('mismatch') ? 'check_circle' : 'cancel' }}</mat-icon>
              <span>{{ !authForm.get('confirmPassword')?.hasError('mismatch') ? ('AUTH.RESET.PASSWORDS_MATCH' | translate) : ('AUTH.RESET.PASSWORD_MISMATCH' | translate) }}</span>
            </div>
            }

            <!-- Submit Button -->
            <button mat-raised-button type="submit" class="create-btn" [disabled]="authForm.invalid || isLoading">
              @if (isLoading) {
              <mat-spinner diameter="22" class="btn-spinner"></mat-spinner>
              }
              @if (!isLoading) {
              <span>{{ 'AUTH.RESET.SUBMIT' | translate }}</span>
              }
            </button>
          </form>

          <!-- Login Link -->
          <div class="login-link">
            <span>{{ 'AUTH.RESET.BACK_TO' | translate }} </span>
            <a routerLink="/authentication/signin" class="login-text">{{ 'AUTH.RESET.LOGIN' | translate }}</a>
          </div>
          }
        </div>
      </div>

      <!-- Right side - Visual -->
      <div class="right-side-section">
        <div class="right-content">
          @if (success) {
          <div class="illustration-wrapper success-illustration">
            <div class="shield-icon">
              <mat-icon>verified_user</mat-icon>
            </div>
          </div>
          <h2>{{ 'AUTH.RESET.RIGHT_SUCCESS_TITLE' | translate }}</h2>
          <p>{{ 'AUTH.RESET.RIGHT_SUCCESS_DESC' | translate }}</p>
          } @else {
          <div class="illustration-wrapper">
            <div class="lock-icon-large">
              <mat-icon>lock_reset</mat-icon>
            </div>
            <div class="floating-elements">
              <div class="dot dot-1"></div>
              <div class="dot dot-2"></div>
              <div class="dot dot-3"></div>
            </div>
          </div>
          <h2>{{ 'AUTH.RESET.RIGHT_TITLE' | translate }}</h2>
          <p>{{ 'AUTH.RESET.RIGHT_SUBTITLE' | translate }}</p>

          <div class="steps-list">
            <div class="step-item" [class.active]="!success">
              <div class="step-number">1</div>
              <span>{{ 'AUTH.RESET.STEP_1' | translate }}</span>
            </div>
            <div class="step-item">
              <div class="step-number">2</div>
              <span>{{ 'AUTH.RESET.STEP_2' | translate }}</span>
            </div>
            <div class="step-item">
              <div class="step-number">3</div>
              <span>{{ 'AUTH.RESET.STEP_3' | translate }}</span>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </mat-card>
</div>
