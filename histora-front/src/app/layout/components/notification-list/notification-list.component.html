<!-- Screen reader announcement for notification count -->
<div class="sr-only" aria-live="polite" aria-atomic="true">
  @if (unreadCount > 0) {
    {{ unreadCount }} {{ unreadCount === 1 ? 'notificación nueva' : 'notificaciones nuevas' }}
  }
</div>

<button mat-icon-button
  [matMenuTriggerFor]="notificationMenu"
  class="nav-notification-icons"
  [attr.aria-label]="unreadCount > 0 ? 'Notificaciones, ' + unreadCount + ' sin leer' : 'Notificaciones'"
  aria-haspopup="menu">
  <i class="material-icons-outlined icon-color" aria-hidden="true">notifications_active</i>
  @if (unreadCount > 0) {
    <span class="notification-badge" aria-hidden="true">{{unreadCount}}</span>
  }
</button>

<mat-menu #notificationMenu="matMenu" class="notification-menu" role="menu" aria-label="Lista de notificaciones">
  <div class="notification-header" role="group" aria-label="Acciones de notificaciones">
    <h6 class="mb-0" id="notification-menu-title">{{ 'HEADER.NOTIFICATIONS' | translate }}</h6>
    <a class="notification-mark-as-read"
      (click)="markAll()"
      role="button"
      tabindex="0"
      (keydown.enter)="markAll()"
      aria-label="Marcar todas las notificaciones como leídas">
      {{ 'NOTIFICATIONS.MARK_ALL_READ' | translate }}
    </a>
  </div>
  <div class="notification-dropdown" role="region" aria-labelledby="notification-menu-title">
    <ng-scrollbar style="height: 350px" visibility="hover">
      <div class="noti-list" role="list" aria-label="Lista de notificaciones">
        <div class="menu">
          <div>
            @for (notification of notifications; track notification; let i = $index) {
              <button mat-menu-item onClick="return false;"
                [ngClass]="[notification.status, isRemoving(notification) ? 'notification-removing' : '']"
                [@notificationAnimation]="isRemoving(notification) ? 'void' : ''"
                (click)="markAsRead(notification)"
                [attr.aria-label]="notification.message + '. ' + notification.time + (notification.status === 'msg-unread' ? '. Sin leer' : '')">
                <span class="menu-info">
                  <div class="notification-content-row">
                    <span class="table-img msg-user" aria-hidden="true">
                      @if (notification.userImg) {
                        <img [src]="notification.userImg" alt="" class="user-avatar">
                      } @else {
                        <i class="material-icons-outlined notification-type-icon"
                        [ngClass]="[notification.color]">{{notification.icon}}</i>
                      }
                    </span>
                    <div>
                      <span class="menu-title">{{notification.message}}</span>
                      <span class="menu-desc">
                        <i class="material-icons" aria-hidden="true">access_time</i>
                        <span class="sr-only">Hace </span>{{notification.time}}
                      </span>
                      @if (notification.actionLabel) {
                        <button mat-stroked-button color="primary"
                          class="notification-action-btn mt-2"
                          (click)="$event.stopPropagation(); onActionClick(notification)"
                          [attr.aria-label]="notification.actionLabel + ' para: ' + notification.message">
                          {{notification.actionLabel}}
                        </button>
                      }
                    </div>
                  </div>
                </span>
                <span class="notification-close"
                  (click)="$event.stopPropagation(); removeNotification(notification)"
                  role="button"
                  tabindex="0"
                  (keydown.enter)="$event.stopPropagation(); removeNotification(notification)"
                  [attr.aria-label]="'Cerrar notificación: ' + notification.message">
                  <app-feather-icons [icon]="'x'" [class]="'user-menu-icons'"></app-feather-icons>
                </span>
              </button>
            }
          </div>
        </div>
      </div>
    </ng-scrollbar>
  </div>
  <div class="notification-footer">
    <a class="notification-read-all"
      (click)="readAllNotifications()"
      role="button"
      tabindex="0"
      (keydown.enter)="readAllNotifications()"
      aria-label="Ver todas las notificaciones">
      {{ 'COMMON.ACTIONS.VIEW_ALL' | translate }}
    </a>
  </div>
</mat-menu>