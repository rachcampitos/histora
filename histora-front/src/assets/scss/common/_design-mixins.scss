// =============================================================================
// HISTORA DESIGN MIXINS
// Mixins reutilizables para consistencia en estilos
// =============================================================================

@use "design-tokens" as tokens;

// -----------------------------------------------------------------------------
// RESPONSIVE MIXINS
// -----------------------------------------------------------------------------

/// Mixin para media queries responsivas
/// @param {String} $breakpoint - xs, sm, md, lg, xl, 2xl
@mixin respond-to($breakpoint) {
  @if $breakpoint == 'xs' {
    @media (max-width: #{tokens.$breakpoint-xs}) { @content; }
  }
  @else if $breakpoint == 'sm' {
    @media (min-width: #{tokens.$breakpoint-sm}) { @content; }
  }
  @else if $breakpoint == 'sm-down' {
    @media (max-width: #{tokens.$breakpoint-sm - 1}) { @content; }
  }
  @else if $breakpoint == 'md' {
    @media (min-width: #{tokens.$breakpoint-md}) { @content; }
  }
  @else if $breakpoint == 'md-down' {
    @media (max-width: #{tokens.$breakpoint-md - 1}) { @content; }
  }
  @else if $breakpoint == 'lg' {
    @media (min-width: #{tokens.$breakpoint-lg}) { @content; }
  }
  @else if $breakpoint == 'lg-down' {
    @media (max-width: #{tokens.$breakpoint-lg - 1}) { @content; }
  }
  @else if $breakpoint == 'xl' {
    @media (min-width: #{tokens.$breakpoint-xl}) { @content; }
  }
  @else if $breakpoint == 'xl-down' {
    @media (max-width: #{tokens.$breakpoint-xl - 1}) { @content; }
  }
  @else if $breakpoint == '2xl' {
    @media (min-width: #{tokens.$breakpoint-2xl}) { @content; }
  }
}

/// Mixin para rango de breakpoints
@mixin respond-between($min, $max) {
  @media (min-width: $min) and (max-width: $max) { @content; }
}

// -----------------------------------------------------------------------------
// ANIMATION MIXINS (with prefers-reduced-motion support)
// -----------------------------------------------------------------------------

/// Mixin para transiciones que respeta prefers-reduced-motion
/// @param {String|List} $properties - Propiedades CSS a animar
/// @param {Time} $duration - Duración de la transición
/// @param {String} $easing - Función de easing
@mixin transition($properties, $duration: tokens.$duration-normal, $easing: tokens.$easing-standard) {
  transition-property: $properties;
  transition-duration: $duration;
  transition-timing-function: $easing;

  @media (prefers-reduced-motion: reduce) {
    transition-duration: 0.01ms;
  }
}

/// Mixin para animaciones que respeta prefers-reduced-motion
/// @param {String} $name - Nombre de la animación
/// @param {Time} $duration - Duración
/// @param {String} $easing - Función de easing
/// @param {String} $fill-mode - animation-fill-mode
@mixin animate($name, $duration: tokens.$duration-normal, $easing: tokens.$easing-standard, $fill-mode: forwards) {
  animation-name: $name;
  animation-duration: $duration;
  animation-timing-function: $easing;
  animation-fill-mode: $fill-mode;

  @media (prefers-reduced-motion: reduce) {
    animation-duration: 0.01ms;
    animation-iteration-count: 1;
  }
}

/// Mixin para deshabilitar animaciones completamente
@mixin no-motion {
  @media (prefers-reduced-motion: reduce) {
    animation: none !important;
    transition: none !important;
  }
}

// -----------------------------------------------------------------------------
// TYPOGRAPHY MIXINS
// -----------------------------------------------------------------------------

/// Mixin para truncar texto con ellipsis
@mixin text-truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/// Mixin para truncar texto multilínea
@mixin text-line-clamp($lines: 2) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/// Mixin para headings
@mixin heading($size: 'lg') {
  font-family: tokens.$font-family-primary;
  font-weight: tokens.$font-weight-semibold;
  line-height: tokens.$line-height-tight;
  color: tokens.$text-primary;

  @if $size == 'xs' {
    font-size: tokens.$font-size-sm;
  }
  @else if $size == 'sm' {
    font-size: tokens.$font-size-base;
  }
  @else if $size == 'md' {
    font-size: tokens.$font-size-md;
  }
  @else if $size == 'lg' {
    font-size: tokens.$font-size-lg;
  }
  @else if $size == 'xl' {
    font-size: tokens.$font-size-xl;
  }
  @else if $size == '2xl' {
    font-size: tokens.$font-size-2xl;
  }
}

/// Mixin para body text
@mixin body-text($size: 'base') {
  font-family: tokens.$font-family-primary;
  font-weight: tokens.$font-weight-regular;
  line-height: tokens.$line-height-normal;

  @if $size == 'sm' {
    font-size: tokens.$font-size-sm;
  }
  @else if $size == 'base' {
    font-size: tokens.$font-size-base;
  }
  @else if $size == 'lg' {
    font-size: tokens.$font-size-md;
  }
}

// -----------------------------------------------------------------------------
// ACCESSIBILITY MIXINS
// -----------------------------------------------------------------------------

/// Clase para ocultar visualmente pero mantener accesible para screen readers
@mixin sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/// Focus visible outline para accesibilidad
@mixin focus-visible($color: tokens.$color-primary, $offset: 2px) {
  &:focus-visible {
    outline: 2px solid $color;
    outline-offset: $offset;
  }
}

/// Focus ring para elementos interactivos
@mixin focus-ring($color: tokens.$color-primary) {
  &:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba($color, 0.3);
  }

  &:focus:not(:focus-visible) {
    box-shadow: none;
  }

  &:focus-visible {
    box-shadow: 0 0 0 3px rgba($color, 0.3);
  }
}

/// High contrast mode support
@mixin high-contrast {
  @media (prefers-contrast: high) {
    @content;
  }
}

// -----------------------------------------------------------------------------
// LAYOUT MIXINS
// -----------------------------------------------------------------------------

/// Flexbox center
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

/// Flexbox between
@mixin flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/// Absolute center
@mixin absolute-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

/// Container with max-width
@mixin container($max-width: tokens.$breakpoint-xl) {
  width: 100%;
  max-width: $max-width;
  margin-left: auto;
  margin-right: auto;
  padding-left: tokens.$spacing-4;
  padding-right: tokens.$spacing-4;
}

// -----------------------------------------------------------------------------
// COMPONENT MIXINS
// -----------------------------------------------------------------------------

/// Card base styles
@mixin card-base {
  background: tokens.$surface-primary;
  border-radius: tokens.$card-radius;
  box-shadow: tokens.$card-shadow;
  @include transition(box-shadow, transform);

  .dark & {
    background: tokens.$surface-dark-primary;
    box-shadow: tokens.$shadow-dark-sm;
  }
}

/// Card interactive (hover effects)
@mixin card-interactive {
  @include card-base;
  cursor: pointer;

  &:hover {
    box-shadow: tokens.$card-shadow-hover;
    transform: translateY(-2px);
  }

  @include focus-visible;

  @media (prefers-reduced-motion: reduce) {
    &:hover {
      transform: none;
    }
  }
}

/// Button base styles
@mixin button-base($size: 'md') {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: tokens.$spacing-2;
  font-family: tokens.$font-family-primary;
  font-weight: tokens.$font-weight-medium;
  border-radius: tokens.$button-radius;
  cursor: pointer;
  @include transition(background-color, box-shadow, transform);
  @include focus-ring;

  @if $size == 'sm' {
    height: tokens.$button-height-sm;
    padding: 0 tokens.$spacing-3;
    font-size: tokens.$font-size-sm;
  }
  @else if $size == 'md' {
    height: tokens.$button-height-md;
    padding: 0 tokens.$spacing-4;
    font-size: tokens.$font-size-sm;
  }
  @else if $size == 'lg' {
    height: tokens.$button-height-lg;
    padding: 0 tokens.$spacing-6;
    font-size: tokens.$font-size-base;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

/// Input base styles
@mixin input-base {
  height: tokens.$input-height;
  padding: 0 tokens.$input-padding-x;
  font-family: tokens.$font-family-primary;
  font-size: tokens.$font-size-base;
  border: tokens.$input-border-width solid tokens.$border-default;
  border-radius: tokens.$input-radius;
  background: tokens.$surface-primary;
  color: tokens.$text-primary;
  @include transition(border-color, box-shadow);

  &::placeholder {
    color: tokens.$text-placeholder;
  }

  &:focus {
    outline: none;
    border-color: tokens.$color-primary;
    box-shadow: 0 0 0 3px rgba(tokens.$color-primary, 0.1);
  }

  &:disabled {
    background: tokens.$surface-secondary;
    color: tokens.$text-disabled;
    cursor: not-allowed;
  }

  .dark & {
    background: tokens.$surface-dark-secondary;
    border-color: tokens.$surface-dark-tertiary;
    color: tokens.$text-dark-primary;

    &::placeholder {
      color: tokens.$text-dark-tertiary;
    }
  }
}

// -----------------------------------------------------------------------------
// SKELETON LOADER MIXIN
// -----------------------------------------------------------------------------

/// Skeleton loading animation
@mixin skeleton-base {
  background: linear-gradient(
    90deg,
    tokens.$color-neutral-200 25%,
    tokens.$color-neutral-100 50%,
    tokens.$color-neutral-200 75%
  );
  background-size: 200% 100%;
  animation: skeleton-shimmer 1.5s ease-in-out infinite;
  border-radius: tokens.$radius-default;

  @media (prefers-reduced-motion: reduce) {
    animation: none;
    background: tokens.$color-neutral-200;
  }

  .dark & {
    background: linear-gradient(
      90deg,
      tokens.$surface-dark-secondary 25%,
      tokens.$surface-dark-tertiary 50%,
      tokens.$surface-dark-secondary 75%
    );
    background-size: 200% 100%;

    @media (prefers-reduced-motion: reduce) {
      background: tokens.$surface-dark-secondary;
    }
  }
}

@keyframes skeleton-shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

// -----------------------------------------------------------------------------
// ICON MIXINS
// -----------------------------------------------------------------------------

/// Icon colors based on semantic meaning
@mixin icon-color($type: 'default') {
  @if $type == 'primary' {
    color: tokens.$color-primary;
  }
  @else if $type == 'secondary' {
    color: tokens.$text-secondary;
  }
  @else if $type == 'success' {
    color: tokens.$color-success;
  }
  @else if $type == 'error' {
    color: tokens.$color-error;
  }
  @else if $type == 'warning' {
    color: tokens.$color-warning;
  }
  @else if $type == 'info' {
    color: tokens.$color-info;
  }
  @else {
    color: tokens.$text-secondary;
  }
}

/// Icon size presets
@mixin icon-size($size: 'md') {
  @if $size == 'xs' {
    font-size: 16px;
    width: 16px;
    height: 16px;
  }
  @else if $size == 'sm' {
    font-size: 20px;
    width: 20px;
    height: 20px;
  }
  @else if $size == 'md' {
    font-size: 24px;
    width: 24px;
    height: 24px;
  }
  @else if $size == 'lg' {
    font-size: 32px;
    width: 32px;
    height: 32px;
  }
  @else if $size == 'xl' {
    font-size: 48px;
    width: 48px;
    height: 48px;
  }
}
