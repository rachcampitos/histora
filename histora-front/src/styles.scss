/* Histora Global Styles */
/* Updated with WCAG 2.1 AA compliance fixes */

// =============================================================================
// WCAG COLOR CONTRAST FIXES
// =============================================================================

// Placeholders - WCAG AA compliant (4.5:1 ratio)
::placeholder {
  color: #64748b !important; // neutral-500 - passes WCAG AA
  opacity: 1;
}

::-webkit-input-placeholder { color: #64748b !important; }
::-moz-placeholder { color: #64748b !important; }
:-ms-input-placeholder { color: #64748b !important; }

// Secondary text and icons - WCAG AA compliant
.text-muted,
.text-secondary {
  color: #475569 !important; // neutral-600 - passes WCAG AA
}

// Fix icon colors for accessibility
.mat-icon.text-muted,
.icon-muted,
.icon-secondary {
  color: #64748b !important; // neutral-500 - passes WCAG AA on white
}

// Dark mode contrast fixes
body.dark {
  ::placeholder {
    color: #94a3b8 !important; // neutral-400 on dark
  }

  .text-muted,
  .text-secondary {
    color: #cbd5e1 !important; // neutral-300 on dark
  }

  .mat-icon.text-muted,
  .icon-muted,
  .icon-secondary {
    color: #94a3b8 !important;
  }
}

// =============================================================================
// REDUCED MOTION SUPPORT
// =============================================================================

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

// =============================================================================
// LAYOUT FIXES
// =============================================================================

/* Prevent horizontal scroll on mobile */
html, body {
  overflow-x: hidden !important;
  max-width: 100vw !important;
}

@media screen and (max-width: 768px) {
  html, body {
    overflow-x: hidden !important;
    width: 100% !important;
    max-width: 100% !important;
    position: relative !important;
  }

  /* Prevent any element from causing horizontal overflow */
  *, *::before, *::after {
    max-width: 100vw;
  }

  /* Main app container */
  app-root,
  app-main-layout,
  .main-container {
    overflow-x: hidden !important;
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Sidebar - hide completely on mobile when closed */
  .sidebar {
    left: -280px !important;
    margin-left: 0 !important;
  }

  /* Show sidebar when overlay is open */
  .overlay-open .sidebar,
  body.overlay-open .sidebar {
    left: 0 !important;
  }

  /* Hide right sidebar completely */
  .right-sidebar {
    display: none !important;
  }

  /* Tables can cause overflow - make them scrollable within their container */
  .table-scroll,
  .responsive_table,
  .overflow-auto {
    overflow-x: auto !important;
    max-width: 100% !important;
    -webkit-overflow-scrolling: touch;
  }

  table.mat-mdc-table {
    min-width: 600px; /* Allow table to scroll, not the page */
  }

  /* Additional overflow prevention */
  .row {
    margin-left: 0 !important;
    margin-right: 0 !important;
  }

  .col-lg-12,
  .col-md-12,
  .col-sm-12,
  .col-xs-12,
  [class*="col-"] {
    padding-left: 5px !important;
    padding-right: 5px !important;
  }

  /* Navbar fixes */
  .navbar {
    width: 100% !important;
    max-width: 100% !important;
    left: 0 !important;
    right: 0 !important;
  }

  /* Content area */
  .content-block {
    width: 100% !important;
    max-width: 100% !important;
  }
}

/* Ensure overlay menus appear above navbar (z-index: 999) and sidebar */
.cdk-overlay-container {
  z-index: 10000 !important;
  position: fixed;
}

/* Mat-menu specific fixes */
.cdk-overlay-connected-position-bounding-box {
  z-index: 10001 !important;
}

/* Ensure menu panel is clickable and above backdrop */
.mat-mdc-menu-panel {
  position: relative;
  z-index: 1 !important;
  pointer-events: auto !important;
}

.mat-mdc-menu-content {
  pointer-events: auto !important;
}

.mat-mdc-menu-item {
  pointer-events: auto !important;
  position: relative;
  z-index: 1;
}

/* Ensure backdrop doesn't block menu clicks */
.cdk-overlay-backdrop.cdk-overlay-transparent-backdrop {
  pointer-events: none !important;
}

.cdk-overlay-backdrop.mat-mdc-menu-backdrop {
  pointer-events: auto !important;
}

/* Hide sidebar elements when not in main layout */
body:not(.theme-white):not(.theme-black):not(.theme-purple):not(.theme-orange):not(.theme-cyan):not(.theme-green):not(.theme-blue) {
  .sidebar,
  .overlay,
  .right-sidebar {
    display: none !important;
  }
}

/* Ensure overlay doesn't block auth pages */
.auth-container ~ .overlay,
.auth-container ~ .sidebar {
  display: none !important;
}

/* Prevent iOS Safari zoom on input focus */
@media screen and (max-width: 768px) {
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="tel"],
  input[type="search"],
  input[type="url"],
  input[type="date"],
  textarea,
  select,
  .mat-mdc-input-element,
  .mat-mdc-select {
    font-size: 16px !important;
  }

  /* Ensure mat-form-field inputs also have 16px */
  .mat-mdc-form-field-input-control {
    font-size: 16px !important;
  }

  /* Mobile container adjustments */
  section.content {
    margin: 55px 8px 0 8px !important;
    width: calc(100% - 16px) !important;
    max-width: 100% !important;
    overflow-x: hidden !important;

    .content-block {
      padding: 10px 5px 0 5px !important;
    }
  }

  /* Card adjustments for mobile */
  .card {
    margin-bottom: 10px !important;
    border-radius: 8px !important;

    .card-header,
    .card-body {
      padding: 12px !important;
    }
  }

  /* Table header adjustments */
  .materialTableHeader {
    flex-direction: column !important;
    gap: 10px !important;
    padding: 10px !important;

    .left,
    .right {
      width: 100% !important;
      float: none !important;
    }

    .tbl-title h2 {
      font-size: 16px !important;
    }

    .tbl-search-box {
      width: 100% !important;

      .search-field {
        width: 100% !important;
      }
    }

    .tbl-export-btn {
      justify-content: flex-start !important;
      flex-wrap: wrap !important;
      gap: 5px !important;
    }
  }

  /* Breadcrumb adjustments */
  .block-header {
    padding: 0 !important;
    margin-bottom: 10px !important;

    .breadcrumb {
      padding: 8px 0 !important;
      font-size: 12px !important;
    }
  }

  /* Paginator adjustments */
  .mat-mdc-paginator {
    .mat-mdc-paginator-container {
      flex-wrap: wrap !important;
      justify-content: center !important;
      padding: 8px !important;
    }

    .mat-mdc-paginator-page-size {
      margin-right: 0 !important;
    }
  }
}
